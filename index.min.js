class e{static parse(e,t={},s=(e=>e)){let r=[],a="",n=0;const i=Object.create(null);i.value="",i.entry=[],i.output=[],i.col=1,i.row=1;const h=RegExp(/"|,|\r\n|\n|\r|[^",\r\n]+/y);for(;null!==(r=h.exec(e));)switch(a=r[0],n){case 0:switch(!0){case'"'===a:n=3;break;case","===a:n=0,this.valueEnd(i);break;case/^(\r\n|\n|\r)$/.test(a):n=0,this.valueEnd(i),this.entryEnd(i);break;default:i.value+=a,n=2}break;case 2:switch(!0){case","===a:n=0,this.valueEnd(i);break;case/^(\r\n|\n|\r)$/.test(a):n=0,this.valueEnd(i),this.entryEnd(i);break;default:throw n=4,Error(`CSVError: Illegal state [row:${i.row}, col:${i.col}]`)}break;case 3:switch(!0){case'"'===a:n=4;break;default:n=3,i.value+=a}break;case 4:switch(!0){case'"'===a:n=3,i.value+=a;break;case","===a:n=0,this.valueEnd(i);break;case/^(\r\n|\n|\r)$/.test(a):n=0,this.valueEnd(i),this.entryEnd(i);break;default:throw Error(`CSVError: Illegal state [row:${i.row}, col:${i.col}]`)}}return 0!==i.entry.length&&(this.valueEnd(i),this.entryEnd(i)),i.output}static stringify(e,t={},s=(e=>e)){t.eof=void 0===t.eof||t.eof;let r="";return e.forEach((s,a)=>{let n="";s.forEach((e,t)=>{e=e.replace('"','""'),n+=/"|,|\r\n|\n|\r/.test(e)?`"${e}"`:e,t!==s.length-1&&(n+=",")}),!1===t.eof?(r+=n,a!==e.length-1&&(r+="\n")):r+=`${n}\n`}),r}static valueEnd(e){e.entry.push(e.value),e.value="",e.col++}static entryEnd(e){e.output.push(e.entry),e.entry=[],e.row++,e.col=1}}class t extends HTMLElement{static get observedAttributes(){return["src","no-headers"]}attributeChangedCallback(e,t,s){this.__initialized&&t!==s&&("no-headers"===e?this.noHeaders=s:this[e]=s)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",e),this.setSrc(e)}get value(){return this.__data}set value(e){this.setValue(e)}get noHeaders(){return this.hasAttribute("no-headers")}set noHeaders(e){const t=this.hasAttribute("no-headers");t?this.setAttribute("no-headers",""):this.removeAttribute("no-headers"),this.setNoHeaders(t)}constructor(){super(),this.__initialized=!1,this.__headers=!0,this.__data=[],this.__table=document.createElement("table"),this.appendChild(this.__table)}async connectedCallback(){this.hasAttribute("no-headers")&&(this.__headers=!1),this.hasAttribute("src")&&this.setSrc(),this.__initialized=!0}async setSrc(){if(this.hasAttribute("src")){const t=await this.fetchSrc(this.src);this.__data=e.parse(t),this.render()}}async fetchSrc(e){const t=await fetch(e);if(200!==t.status)throw Error(`ERR ${t.status}: ${t.statusText}`);return t.text()}setValue(t){this.__data=e.parse(t),this.render()}setNoHeaders(e){this.__headers=!e,this.render()}render(){const e=[...this.__data],t=document.createElement("table");if(this.__headers){const s=e.shift(),r=document.createElement("thead"),a=document.createElement("tr");s.forEach(e=>{const t=document.createElement("th");t.innerText=e,a.appendChild(t)}),r.append(a),t.appendChild(r)}const s=document.createElement("tbody");e.forEach(e=>{const t=document.createElement("tr");e.forEach(e=>{const s=document.createElement("td");s.innerText=e,t.appendChild(s)}),s.appendChild(t)}),t.appendChild(s),this.removeChild(this.__table),this.__table=t,this.appendChild(this.__table)}}customElements.define("wc-csv-table",t);export{t as WCCSVTable};
