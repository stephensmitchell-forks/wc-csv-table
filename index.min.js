function e(e,s,a=(e=>e)){const n=Object.create(null);n.options=s||{},n.reviver=a,n.value="",n.entry=[],n.output=[],n.col=1,n.row=1;const c=RegExp(/"|,|\r\n|\n|\r|[^",\r\n]+/y);let i=[],h="",o=0;for(;null!==(i=c.exec(e));)switch(h=i[0],o){case 0:switch(!0){case'"'===h:o=3;break;case","===h:o=0,t(n);break;case/^(\r\n|\n|\r)$/.test(h):o=0,t(n),r(n);break;default:n.value+=h,o=2}break;case 2:switch(!0){case","===h:o=0,t(n);break;case/^(\r\n|\n|\r)$/.test(h):o=0,t(n),r(n);break;default:throw o=4,Error(`CSVError: Illegal state [row:${n.row}, col:${n.col}]`)}break;case 3:switch(!0){case'"'===h:o=4;break;default:o=3,n.value+=h}break;case 4:switch(!0){case'"'===h:o=3,n.value+=h;break;case","===h:o=0,t(n);break;case/^(\r\n|\n|\r)$/.test(h):o=0,t(n),r(n);break;default:throw Error(`CSVError: Illegal state [row:${n.row}, col:${n.col}]`)}}return 0!==n.entry.length&&(t(n),r(n)),n.output}function t(e){const t=e.options.typed?function(e){switch(!0){case"true"===e:case"false"===e:return"true"===e;case/.\./.test(e):return parseFloat(e);case isFinite(e):return parseInt(e);default:return e}}(e.value):e.value;e.entry.push(e.reviver(t,e.row,e.col)),e.value="",e.col++}function r(e){e.output.push(e.entry),e.entry=[],e.row++,e.col=1}class s extends HTMLElement{static get observedAttributes(){return["src","no-headers"]}attributeChangedCallback(e,t,r){this.__initialized&&t!==r&&("no-headers"===e?this.noHeaders=r:this[e]=r)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",e),this.setSrc(e)}get value(){return this.__data}set value(e){this.setValue(e)}get noHeaders(){return this.hasAttribute("no-headers")}set noHeaders(e){const t=this.hasAttribute("no-headers");t?this.setAttribute("no-headers",""):this.removeAttribute("no-headers"),this.setNoHeaders(t)}constructor(){super(),this.__initialized=!1,this.__headers=!0,this.__data=[],this.__table=document.createElement("table"),this.appendChild(this.__table)}async connectedCallback(){this.hasAttribute("no-headers")&&(this.__headers=!1),this.hasAttribute("src")&&this.setSrc(),this.__initialized=!0}async setSrc(){if(this.hasAttribute("src")){const t=await this.fetchSrc(this.src);this.__data=e(t),this.render()}}async fetchSrc(e){const t=await fetch(e);if(200!==t.status)throw Error(`ERR ${t.status}: ${t.statusText}`);return t.text()}setValue(t){this.__data=e(t),this.render()}setNoHeaders(e){this.__headers=!e,this.render()}render(){const e=[...this.__data],t=document.createElement("table");if(this.__headers){const r=e.shift(),s=document.createElement("thead"),a=document.createElement("tr");r.forEach(e=>{const t=document.createElement("th");t.innerText=e,a.appendChild(t)}),s.append(a),t.appendChild(s)}const r=document.createElement("tbody");e.forEach(e=>{const t=document.createElement("tr");e.forEach(e=>{const r=document.createElement("td");r.innerText=e,t.appendChild(r)}),r.appendChild(t)}),t.appendChild(r),this.removeChild(this.__table),this.__table=t,this.appendChild(this.__table)}}customElements.define("wc-csv-table",s);export{s as WCCSVTable};
