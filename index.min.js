function e(e,r,a=(e=>e)){const n=Object.create(null);n.options=r||{},n.reviver=a,n.value="",n.entry=[],n.output=[],n.col=1,n.row=1;const c=new RegExp(/"|,|\r\n|\n|\r|[^",\r\n]+/y),i=new RegExp(/^(\r\n|\n|\r)$/);let h=[],o="",l=0;for(;null!==(h=c.exec(e));)switch(o=h[0],l){case 0:switch(!0){case'"'===o:l=3;break;case","===o:l=0,t(n);break;case i.test(o):l=0,t(n),s(n);break;default:n.value+=o,l=2}break;case 2:switch(!0){case","===o:l=0,t(n);break;case i.test(o):l=0,t(n),s(n);break;default:throw l=4,Error(`CSVError: Illegal state [row:${n.row}, col:${n.col}]`)}break;case 3:switch(!0){case'"'===o:l=4;break;default:l=3,n.value+=o}break;case 4:switch(!0){case'"'===o:l=3,n.value+=o;break;case","===o:l=0,t(n);break;case i.test(o):l=0,t(n),s(n);break;default:throw Error(`CSVError: Illegal state [row:${n.row}, col:${n.col}]`)}}return 0!==n.entry.length&&(t(n),s(n)),n.output}function t(e){const t=e.options.typed?function(e){const t=new RegExp(/.\./);switch(!0){case"true"===e:case"false"===e:return"true"===e;case t.test(e):return parseFloat(e);case isFinite(e):return parseInt(e);default:return e}}(e.value):e.value;e.entry.push(e.reviver(t,e.row,e.col)),e.value="",e.col++}function s(e){e.output.push(e.entry),e.entry=[],e.row++,e.col=1}class r extends HTMLElement{static get observedAttributes(){return["src","no-headers"]}attributeChangedCallback(e,t,s){this.__initialized&&t!==s&&("no-headers"===e?this.noHeaders=s:this[e]=s)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",e),this.setSrc(e)}get value(){return this.__data}set value(e){this.setValue(e)}get noHeaders(){return this.hasAttribute("no-headers")}set noHeaders(e){const t=this.hasAttribute("no-headers");t?this.setAttribute("no-headers",""):this.removeAttribute("no-headers"),this.setNoHeaders(t)}constructor(){super(),this.__initialized=!1,this.__headers=!0,this.__data=[],this.__table=document.createElement("table"),this.appendChild(this.__table)}async connectedCallback(){this.hasAttribute("no-headers")&&(this.__headers=!1),this.hasAttribute("src")&&this.setSrc(),this.__initialized=!0}async setSrc(){if(this.hasAttribute("src")){const t=await this.fetchSrc(this.src);this.__data=e(t),this.render()}}async fetchSrc(e){const t=await fetch(e);if(200!==t.status)throw Error(`ERR ${t.status}: ${t.statusText}`);return t.text()}setValue(t){this.__data=e(t),this.render()}setNoHeaders(e){this.__headers=!e,this.render()}render(){const e=[...this.__data],t=document.createElement("table");if(this.__headers){const s=e.shift(),r=document.createElement("thead"),a=document.createElement("tr");s.forEach(e=>{const t=document.createElement("th");t.innerText=e,a.appendChild(t)}),r.append(a),t.appendChild(r)}const s=document.createElement("tbody");e.forEach(e=>{const t=document.createElement("tr");e.forEach(e=>{const s=document.createElement("td");s.innerText=e,t.appendChild(s)}),s.appendChild(t)}),t.appendChild(s),this.removeChild(this.__table),this.__table=t,this.appendChild(this.__table)}}customElements.define("wc-csv-table",r);export{r as WCCSVTable};
